@model Order


@{
    ViewData["Title"] = "Orders History";
    Layout = "_ProfileLayout";

    string bgColor;
    switch (@Model.Status)
    {
        case "Shipping":
            bgColor = "#2563eb";
            break;
        case "Pending":
            bgColor = "#a1a1aa";
            break;
        case "Complete":
            bgColor = "#16a34a";
            break;
        case "Cooking":
            bgColor = "#ff9500";
            break;
        case "Cancel":
            bgColor = "#dc2626";
            break;
        default:
            bgColor = "#ca8a04";
            break;
    }
}



<div class="max-w-screen-md mx-auto p-4">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-semibold">Chi tiết đơn hàng</h2>
        <p class="px-3 py-1 rounded-lg bg-[@bgColor] text-white">@Model.Status</p>
    </div>

    <div class="flex flex-col mb-8">
        <div class="flex flex-row justify-between items-center mb-4">
            <p class="font-semibold">Mã đơn hàng:</p>
            <p>@Model.OrderId</p>
        </div>
        <div class="flex flex-row justify-between items-center mb-4">
            <p class="font-semibold">Ngày đặt:</p>
            <p>@Model.OrderDate</p>
        </div>
        <div class="flex flex-row justify-between items-center">
            <p class="font-semibold">Tên khách hàng:</p>
            <p>@Model.Customer.FullName</p>
        </div>
    </div>
    <table class="w-full mb-8">
        <thead>
            <tr class="border-b border-gray-300">
                <th class="pb-2">Product</th>
                <th class="pb-2">Hình ảnh</th>
                <th class="pb-2">Giá sản phẩm</th>
                <th class="pb-2">Số lượng</th>
                <th class="pb-2">Tạm tính</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var detail in Model.OrderDetails)
            {
                <tr class="border-b border-gray-300">
                    <td class="py-4">@detail.Product.Name</td>
                    <td class="py-4">
                        <img src="@Url.Content("~/Uploads/" + detail.Product.ImagePath)" alt="Product Image" class="w-16 h-16 object-cover rounded-lg" />
                    </td>
                    <td class="py-4">@string.Format("{0:N0} VNĐ", @detail.PricePerUnit)</td>
                    <td class="py-4">@detail.Quantity</td>
                    <td class="py-4">@string.Format("{0:N0} VNĐ", detail.PricePerUnit * detail.Quantity)</td>
                </tr>
            }
        </tbody>
    </table>
    <div class="flex flex-col">
        <div class="flex items-center space-x-3">
            <p class="font-bold">Tổng cộng:</p>
            <p class="py-4">@string.Format("{0:N0} VNĐ", Model.TotalPrice)</p>
        </div>
        <div class="flex space-x-10">
            <a asp-controller="Home" asp-action="OrdersHistory" class="hover:bg-blue-700 bg-blue-600 text-center p-2.5 rounded text-white w-full md:max-w-[100px]">Quay lại</a>
            @if (Model.Status == "Pending")
            {
                <form asp-controller="Home" asp-action="CancelOrderFromCustomer" asp-route-orderId="@Model.OrderId" method="post" id="ProcessCheckoutForm">
                    <button type="submit" class="bg-red-700 p-2.5 rounded-lg text-white" @(Model.Status == "Complete" ? "disabled" : "")>Huỷ đơn hàng</button>
                    @*<button type="submit" class="bg-red-700 p-2.5 rounded-lg text-white" onclick="return confirm('Are you sure you want to cancel this order?');" @(Model.Status == "Complete" ? "disabled" : "")>Huỷ đơn hàng</button>*@
                </form>
            }
        </div>
        
    </div>
</div>

<div id="confirmationPopup" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-40">
    <div class="bg-white p-5 rounded-lg">
        <h4 class="font-bold text-xl mb-3">Xác nhận huỷ đơn hàng</h4>
        <p class="mb-5">Bạn có chắc chắn muốn huỷ đơn hàng không?</p>
        <div class="flex justify-end">
            <button type="button" id="confirmBtn" class="focus:outline-none text-white bg-green-700 hover:bg-green-800 focus:ring-4 focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2">Xác nhận</button>
            <button type="button" id="cancelBtn" class="focus:outline-none text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2">Huỷ</button>
        </div>
    </div>
</div>

<script>document.getElementById("cancelBtn").addEventListener("click", function () {
    document.getElementById("confirmationPopup").classList.add("hidden");
    // Perform your desired action here (e.g., show a message, do nothing)
});

document.getElementById("ProcessCheckoutForm").addEventListener("submit", function (event) {
    event.preventDefault(); // Prevent the default form submission behavior

    document.getElementById("confirmationPopup").classList.remove("hidden");
});

document.getElementById("confirmBtn").addEventListener("click", function () {
    document.getElementById("confirmationPopup").classList.add("hidden");
    setTimeout(function () {
        document.getElementById("ProcessCheckoutForm").submit(); // Submit the form
    }, 100);
});</script>