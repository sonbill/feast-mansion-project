@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "Dashboard Page";
    Layout = "_Layout";
}

@{
    decimal currentMonthRevenue = (decimal)ViewData["CurrentMonthRevenue"];
    decimal selectedMonthRevenue = (decimal)ViewData["SelectedMonthRevenue"];   
    decimal previousMonthRevenue = (decimal)ViewData["PreviousMonthRevenue"];
    int completedOrders = (int)ViewData["CompletedOrders"];
    int canceledOrders = (int)ViewData["CanceledOrders"];

    int selectCompletedOrders = (int)ViewData["SelectCompletedOrders"];
    int selectCanceledOrders = (int)ViewData["SelectCanceledOrders"];
    int selectTotalOrders = (int)ViewData["SelectTotalOrders"];
    int totalOrders = (int)ViewData["TotalOrders"];
    decimal profit = (decimal)ViewData["Profit"];
    int numberOfCompletedOrders = (int)ViewData["NumberOfCompletedOrders"];
    int numberOfCanceledOrders = (int)ViewData["NumberOfCanceledOrders"];
    int previousCompletedOrders = (int)ViewData["PreviousCompletedOrders"];
    int previousCanceledOrders = (int)ViewData["PreviousCanceledOrders"];

}


<div class="container">
    <h2 class="text-2xl font-bold">Dashboard</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        @*Total Revenue*@
        <div class="w-[300px] col-span-1 p-5 rounded-lg space-y-3 bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-blue-300 shadow-lg shadow-blue-500/50">
            <h4 class="text-sm text-center text-white font-bold">Tổng doanh thu trong tháng</h4>
            <div class="flex justify-between">
                <div>
                    <p class="text-sm text-gray-100">Tháng hiện tại</p>
                    <p class="text-lg text-white font-bold">@string.Format("{0:N0} VNĐ", @currentMonthRevenue)</p>
                </div>
                <div>
                    <p class="text-sm text-gray-100">Tháng trước</p>
                    <p class="text-lg text-white font-bold">@string.Format("{0:N0} VNĐ", @previousMonthRevenue)</p>
                </div>
            </div>
            <div class="text-sm">
                @if (currentMonthRevenue < previousMonthRevenue)
                {
                    <p class="text-red-700">Lãi: - @string.Format("{0:N0} VNĐ", @profit)</p>
                }
                else
                {
                    <p class="text-green-400 font-bold">Lãi: + @string.Format("{0:N0} VNĐ", @profit)</p>
                }
            </div>
        </div>
        @*Total Completed Order in Month*@
        <div class="w-[300px] col-span-1 p-5 space-y-3 bg-gradient-to-r from-green-400 via-green-500 to-green-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-green-300 shadow-lg shadow-green-500/50 font-medium rounded-lg text-center">
            <h4 class="text-sm text-center font-bold text-white">Tổng đơn hàng đã giao trong tháng</h4>
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-100">Đơn đã giao</p>
                    <p class="text-2xl text-white font-bold">@completedOrders</p>
                </div>
                <div class="text-sm">
                    @if (numberOfCompletedOrders < previousCompletedOrders)
                    {
                        <p class="text-red-700 font-bold text-2xl">
                            <span class="material-icons">
                                arrow_downward
                            </span>
                            @numberOfCompletedOrders
                        </p>
                    }
                    else
                    {
                        <p class="text-green-200 font-bold text-2xl">
                            <span class="material-icons">
                                arrow_upward
                            </span>
                            @numberOfCompletedOrders
                        </p>
                    }
                </div>
            </div>
        </div>
        @*Total Completed Order in Month*@
        <div class="w-[300px] col-span-1 p-5 rounded-lg space-y-3 bg-gradient-to-r from-red-400 via-red-500 to-red-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-red-300 shadow-lg shadow-red-500/50 text-sm text-center">
            <h4 class="text-sm text-center font-bold text-white">Tổng đơn hàng đã huỷ trong tháng</h4>
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-100">Đơn đã huỷ</p>
                    <p class="text-2xl text-white font-bold">@canceledOrders</p>
                </div>
                <div>
                    @if (numberOfCanceledOrders < previousCanceledOrders)
                    {
                        <p class="text-red-200 text-2xl">
                            <span class="material-icons">
                                arrow_downward
                            </span>
                            @numberOfCanceledOrders
                        </p>
                    }
                    else
                    {
                        <p class="text-green-400 font-bold text-2xl">
                            <span class="material-icons">
                                arrow_upward
                            </span>
                            @numberOfCanceledOrders
                        </p>
                    }
                </div>
            </div>
        </div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-3 mt-10 gap-4">
        <div class="border rounded-lg bg-gray-50 shadow-lg p-5 col-span-1 md:col-span-2">
            <h4 class="text-lg font-bold text-gray-600">Revenue Chart</h4>
            <canvas id="revenueChart" width="250" height="150"></canvas>
        </div>
        <div class="w-[300px] border shadow-lg p-5 rounded-lg col-span-1">
            <h4 class="text-lg font-bold text-gray-600">Tổng đơn hàng</h4>
            <canvas id="orderChart" width="300" height="300"></canvas>
            <div class="flex flex-col space-y-5">
                <div class="text-center">
                    <p>Đơn đã giao</p>
                    <p class="text-4xl font-bold">@completedOrders</p>
                </div>
                <div class="text-center">
                    <p>Đơn đã huỷ</p>
                    <p class="text-4xl font-bold"> @canceledOrders</p>
                </div>
            </div>


        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <form asp-controller="Dashboard" asp-action="Index" method="post">
                <label>Select Date:</label>
                <select class="form-control" id="selectMonth" name="selectMonth">
                    <option value="1">January</option>
                    <option value="2">February</option>
                    <option value="3">March</option>
                    <option value="4">April</option>
                    <option value="5">May</option>
                    <option value="6">June</option>
                    <option value="7">July</option>
                    <option value="8">August</option>
                    <option value="9">September</option>
                    <option value="10">October</option>
                    <option value="11">November</option>
                    <option value="12">December</option>
                </select>
                <select id="selectYear" name="selectYear">
                    <option value="2022">2022</option>
                    <option value="2023">2023</option>
                    <option value="2024">2024</option>
                </select>
                <button type="submit" class="bg-red-700">Lấy kết quả</button>
            </form>
        </div>
        <div class="col-md-6">
            <h4>Order Statistics</h4>
            <p>Đơn đã giao: @selectCompletedOrders</p>
            <p>Đơn đã huỷ: @selectCanceledOrders</p>
            <p>Doanh thu: @string.Format("{0:N0} VNĐ", @selectedMonthRevenue)</p>
            <p>Tổng đơn hàng: @selectTotalOrders</p>
        </div>
    </div>
    <!-- Display the orders -->
    @if (ViewData["OrderViewModels"] != null)
    {
        List<OrderViewModel> orderViewModels = (List<OrderViewModel>)ViewData["OrderViewModels"];
        <h4>Orders in Selected Month</h4>
        <table>
            <tr>
                <th>Order ID</th>
                <th>Customer Name</th>
                <th>Order Date</th>
                <th></th>
            </tr>
            @foreach (var orderViewModel in orderViewModels)
            {
                <tr>
                    <td>@orderViewModel.OrderId</td>
                    <td>@orderViewModel.CustomerId</td>
                    <td>@orderViewModel.OrderDate</td>
                    <td>
                        <a asp-controller="Order" asp-action="Edit" asp-route-id="@orderViewModel.OrderId" class="font-medium text-blue-600 dark:text-blue-500 hover:underline">Edit</a>
                    </td>
                </tr>
            }
        </table>
    }

</div>

@section Scripts {
    <script>
        var OrderCtx = document.getElementById('orderChart').getContext('2d');
        var RevenueCtx = document.getElementById('revenueChart').getContext('2d');

        var orderChart = new Chart(OrderCtx, {
            type: 'doughnut',
            data: {
                labels: ['Complete', 'Cancel'],
                datasets: [{
                    label: 'Order Statistics Chart',
                    data: [@completedOrders, @canceledOrders],
                    backgroundColor: [
                        'rgb(3, 201, 136)',
                        'rgb(244, 80, 80)',                        
                    ],
                    
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
        var revenueChart = new Chart(RevenueCtx, {
            type: 'bar',
            data: {
                labels: ['Doanh thu tháng hiện tại', 'Doanh thu tháng trước'],
                datasets: [{
                    label: ['Bảng doanh thu tháng hiện tại'],
                    data: [@currentMonthRevenue,@previousMonthRevenue],
                    backgroundColor: [
                        'rgb(62,156,53)',
                        'rgb(203, 237, 213)',
                    ],
                    
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });        
    </script>
}



